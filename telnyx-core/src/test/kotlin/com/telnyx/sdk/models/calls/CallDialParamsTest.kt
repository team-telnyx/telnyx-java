// File generated from our OpenAPI spec by Stainless.

package com.telnyx.sdk.models.calls

import com.telnyx.sdk.models.calls.actions.GoogleTranscriptionLanguage
import com.telnyx.sdk.models.calls.actions.TranscriptionEngineGoogleConfig
import com.telnyx.sdk.models.calls.actions.TranscriptionStartRequest
import kotlin.jvm.optionals.getOrNull
import org.assertj.core.api.Assertions.assertThat
import org.junit.jupiter.api.Test

internal class CallDialParamsTest {

    @Test
    fun create() {
        CallDialParams.builder()
            .connectionId("7267xxxxxxxxxxxxxx")
            .from("+18005550101")
            .to("+18005550100 or sip:username@sip.telnyx.com")
            .answeringMachineDetection(CallDialParams.AnsweringMachineDetection.DETECT)
            .answeringMachineDetectionConfig(
                CallDialParams.AnsweringMachineDetectionConfig.builder()
                    .afterGreetingSilenceMillis(1000)
                    .betweenWordsSilenceMillis(1000)
                    .greetingDurationMillis(1000)
                    .greetingSilenceDurationMillis(2000)
                    .greetingTotalAnalysisTimeMillis(50000)
                    .initialSilenceMillis(1000)
                    .maximumNumberOfWords(1000)
                    .maximumWordLengthMillis(2000)
                    .silenceThreshold(512)
                    .totalAnalysisTimeMillis(5000)
                    .build()
            )
            .audioUrl("http://www.example.com/sounds/greeting.wav")
            .billingGroupId("f5586561-8ff0-4291-a0ac-84fe544797bd")
            .bridgeIntent(true)
            .bridgeOnAnswer(true)
            .clientState("aGF2ZSBhIG5pY2UgZGF5ID1d")
            .commandId("891510ac-f3e4-11e8-af5b-de00688a4901")
            .conferenceConfig(
                CallDialParams.ConferenceConfig.builder()
                    .id("0ccc7b54-4df3-4bca-a65a-3da1ecc777f0")
                    .beepEnabled(CallDialParams.ConferenceConfig.BeepEnabled.ON_EXIT)
                    .conferenceName("telnyx-conference")
                    .earlyMedia(false)
                    .endConferenceOnExit(true)
                    .hold(true)
                    .holdAudioUrl("http://example.com/message.wav")
                    .holdMediaName("my_media_uploaded_to_media_storage_api")
                    .mute(true)
                    .softEndConferenceOnExit(true)
                    .startConferenceOnCreate(false)
                    .startConferenceOnEnter(true)
                    .supervisorRole(CallDialParams.ConferenceConfig.SupervisorRole.WHISPER)
                    .addWhisperCallControlId(
                        "v2:Sg1xxxQ_U3ixxxyXT_VDNI3xxxazZdg6Vxxxs4-GNYxxxVaJPOhFMRQ"
                    )
                    .addWhisperCallControlId(
                        "v2:qqpb0mmvd-ovhhBr0BUQQn0fld5jIboaaX3-De0DkqXHzbf8d75xkw"
                    )
                    .build()
            )
            .addCustomHeader(CustomSipHeader.builder().name("head_1").value("val_1").build())
            .addCustomHeader(CustomSipHeader.builder().name("head_2").value("val_2").build())
            .dialogflowConfig(
                DialogflowConfig.builder()
                    .analyzeSentiment(false)
                    .partialAutomatedAgentReply(false)
                    .build()
            )
            .enableDialogflow(false)
            .fromDisplayName("Company Name")
            .linkTo("ilditnZK_eVysupV21KzmzN_sM29ygfauQojpm4BgFtfX5hXAcjotg==")
            .mediaEncryption(CallDialParams.MediaEncryption.SRTP)
            .mediaName("my_media_uploaded_to_media_storage_api")
            .parkAfterUnbridge("self")
            .preferredCodecs("G722,PCMU,PCMA,G729,OPUS,VP8,H264")
            .record(CallDialParams.Record.RECORD_FROM_ANSWER)
            .recordChannels(CallDialParams.RecordChannels.SINGLE)
            .recordCustomFileName("my_recording_file_name")
            .recordFormat(CallDialParams.RecordFormat.WAV)
            .recordMaxLength(1000)
            .recordTimeoutSecs(100)
            .recordTrack(CallDialParams.RecordTrack.OUTBOUND)
            .recordTrim(CallDialParams.RecordTrim.TRIM_SILENCE)
            .sendSilenceWhenIdle(true)
            .sipAuthPassword("password")
            .sipAuthUsername("username")
            .addSipHeader(
                SipHeader.builder().name(SipHeader.Name.USER_TO_USER).value("12345").build()
            )
            .sipRegion(CallDialParams.SipRegion.CANADA)
            .sipTransportProtocol(CallDialParams.SipTransportProtocol.TLS)
            .soundModifications(
                SoundModifications.builder()
                    .octaves(0.1)
                    .pitch(0.8)
                    .semitone(-2.0)
                    .track("both")
                    .build()
            )
            .streamBidirectionalCodec(StreamBidirectionalCodec.G722)
            .streamBidirectionalMode(StreamBidirectionalMode.RTP)
            .streamBidirectionalSamplingRate(StreamBidirectionalSamplingRate.RATE_16000)
            .streamBidirectionalTargetLegs(StreamBidirectionalTargetLegs.BOTH)
            .streamCodec(StreamCodec.PCMA)
            .streamEstablishBeforeCallOriginate(true)
            .streamTrack(CallDialParams.StreamTrack.BOTH_TRACKS)
            .streamUrl("wss://www.example.com/websocket")
            .superviseCallControlId("v3:MdI91X4lWFEs7IgbBEOT9M4AigoY08M0WWZFISt1Yw2axZ_IiE4pqg")
            .supervisorRole(CallDialParams.SupervisorRole.BARGE)
            .timeLimitSecs(60)
            .timeoutSecs(60)
            .transcription(true)
            .transcriptionConfig(
                TranscriptionStartRequest.builder()
                    .clientState("aGF2ZSBhIG5pY2UgZGF5ID1d")
                    .commandId("891510ac-f3e4-11e8-af5b-de00688a4901")
                    .transcriptionEngine(TranscriptionStartRequest.TranscriptionEngine.GOOGLE)
                    .transcriptionEngineConfig(
                        TranscriptionEngineGoogleConfig.builder()
                            .enableSpeakerDiarization(true)
                            .addHint("string")
                            .interimResults(true)
                            .language(GoogleTranscriptionLanguage.EN)
                            .maxSpeakerCount(4)
                            .minSpeakerCount(4)
                            .model(TranscriptionEngineGoogleConfig.Model.LATEST_LONG)
                            .profanityFilter(true)
                            .addSpeechContext(
                                TranscriptionEngineGoogleConfig.SpeechContext.builder()
                                    .boost(1.0)
                                    .addPhrase("string")
                                    .build()
                            )
                            .transcriptionEngine(
                                TranscriptionEngineGoogleConfig.TranscriptionEngine.GOOGLE
                            )
                            .useEnhanced(true)
                            .build()
                    )
                    .transcriptionTracks("both")
                    .build()
            )
            .webhookUrl("https://www.example.com/server-b/")
            .webhookUrlMethod(CallDialParams.WebhookUrlMethod.POST)
            .build()
    }

    @Test
    fun body() {
        val params =
            CallDialParams.builder()
                .connectionId("7267xxxxxxxxxxxxxx")
                .from("+18005550101")
                .to("+18005550100 or sip:username@sip.telnyx.com")
                .answeringMachineDetection(CallDialParams.AnsweringMachineDetection.DETECT)
                .answeringMachineDetectionConfig(
                    CallDialParams.AnsweringMachineDetectionConfig.builder()
                        .afterGreetingSilenceMillis(1000)
                        .betweenWordsSilenceMillis(1000)
                        .greetingDurationMillis(1000)
                        .greetingSilenceDurationMillis(2000)
                        .greetingTotalAnalysisTimeMillis(50000)
                        .initialSilenceMillis(1000)
                        .maximumNumberOfWords(1000)
                        .maximumWordLengthMillis(2000)
                        .silenceThreshold(512)
                        .totalAnalysisTimeMillis(5000)
                        .build()
                )
                .audioUrl("http://www.example.com/sounds/greeting.wav")
                .billingGroupId("f5586561-8ff0-4291-a0ac-84fe544797bd")
                .bridgeIntent(true)
                .bridgeOnAnswer(true)
                .clientState("aGF2ZSBhIG5pY2UgZGF5ID1d")
                .commandId("891510ac-f3e4-11e8-af5b-de00688a4901")
                .conferenceConfig(
                    CallDialParams.ConferenceConfig.builder()
                        .id("0ccc7b54-4df3-4bca-a65a-3da1ecc777f0")
                        .beepEnabled(CallDialParams.ConferenceConfig.BeepEnabled.ON_EXIT)
                        .conferenceName("telnyx-conference")
                        .earlyMedia(false)
                        .endConferenceOnExit(true)
                        .hold(true)
                        .holdAudioUrl("http://example.com/message.wav")
                        .holdMediaName("my_media_uploaded_to_media_storage_api")
                        .mute(true)
                        .softEndConferenceOnExit(true)
                        .startConferenceOnCreate(false)
                        .startConferenceOnEnter(true)
                        .supervisorRole(CallDialParams.ConferenceConfig.SupervisorRole.WHISPER)
                        .addWhisperCallControlId(
                            "v2:Sg1xxxQ_U3ixxxyXT_VDNI3xxxazZdg6Vxxxs4-GNYxxxVaJPOhFMRQ"
                        )
                        .addWhisperCallControlId(
                            "v2:qqpb0mmvd-ovhhBr0BUQQn0fld5jIboaaX3-De0DkqXHzbf8d75xkw"
                        )
                        .build()
                )
                .addCustomHeader(CustomSipHeader.builder().name("head_1").value("val_1").build())
                .addCustomHeader(CustomSipHeader.builder().name("head_2").value("val_2").build())
                .dialogflowConfig(
                    DialogflowConfig.builder()
                        .analyzeSentiment(false)
                        .partialAutomatedAgentReply(false)
                        .build()
                )
                .enableDialogflow(false)
                .fromDisplayName("Company Name")
                .linkTo("ilditnZK_eVysupV21KzmzN_sM29ygfauQojpm4BgFtfX5hXAcjotg==")
                .mediaEncryption(CallDialParams.MediaEncryption.SRTP)
                .mediaName("my_media_uploaded_to_media_storage_api")
                .parkAfterUnbridge("self")
                .preferredCodecs("G722,PCMU,PCMA,G729,OPUS,VP8,H264")
                .record(CallDialParams.Record.RECORD_FROM_ANSWER)
                .recordChannels(CallDialParams.RecordChannels.SINGLE)
                .recordCustomFileName("my_recording_file_name")
                .recordFormat(CallDialParams.RecordFormat.WAV)
                .recordMaxLength(1000)
                .recordTimeoutSecs(100)
                .recordTrack(CallDialParams.RecordTrack.OUTBOUND)
                .recordTrim(CallDialParams.RecordTrim.TRIM_SILENCE)
                .sendSilenceWhenIdle(true)
                .sipAuthPassword("password")
                .sipAuthUsername("username")
                .addSipHeader(
                    SipHeader.builder().name(SipHeader.Name.USER_TO_USER).value("12345").build()
                )
                .sipRegion(CallDialParams.SipRegion.CANADA)
                .sipTransportProtocol(CallDialParams.SipTransportProtocol.TLS)
                .soundModifications(
                    SoundModifications.builder()
                        .octaves(0.1)
                        .pitch(0.8)
                        .semitone(-2.0)
                        .track("both")
                        .build()
                )
                .streamBidirectionalCodec(StreamBidirectionalCodec.G722)
                .streamBidirectionalMode(StreamBidirectionalMode.RTP)
                .streamBidirectionalSamplingRate(StreamBidirectionalSamplingRate.RATE_16000)
                .streamBidirectionalTargetLegs(StreamBidirectionalTargetLegs.BOTH)
                .streamCodec(StreamCodec.PCMA)
                .streamEstablishBeforeCallOriginate(true)
                .streamTrack(CallDialParams.StreamTrack.BOTH_TRACKS)
                .streamUrl("wss://www.example.com/websocket")
                .superviseCallControlId("v3:MdI91X4lWFEs7IgbBEOT9M4AigoY08M0WWZFISt1Yw2axZ_IiE4pqg")
                .supervisorRole(CallDialParams.SupervisorRole.BARGE)
                .timeLimitSecs(60)
                .timeoutSecs(60)
                .transcription(true)
                .transcriptionConfig(
                    TranscriptionStartRequest.builder()
                        .clientState("aGF2ZSBhIG5pY2UgZGF5ID1d")
                        .commandId("891510ac-f3e4-11e8-af5b-de00688a4901")
                        .transcriptionEngine(TranscriptionStartRequest.TranscriptionEngine.GOOGLE)
                        .transcriptionEngineConfig(
                            TranscriptionEngineGoogleConfig.builder()
                                .enableSpeakerDiarization(true)
                                .addHint("string")
                                .interimResults(true)
                                .language(GoogleTranscriptionLanguage.EN)
                                .maxSpeakerCount(4)
                                .minSpeakerCount(4)
                                .model(TranscriptionEngineGoogleConfig.Model.LATEST_LONG)
                                .profanityFilter(true)
                                .addSpeechContext(
                                    TranscriptionEngineGoogleConfig.SpeechContext.builder()
                                        .boost(1.0)
                                        .addPhrase("string")
                                        .build()
                                )
                                .transcriptionEngine(
                                    TranscriptionEngineGoogleConfig.TranscriptionEngine.GOOGLE
                                )
                                .useEnhanced(true)
                                .build()
                        )
                        .transcriptionTracks("both")
                        .build()
                )
                .webhookUrl("https://www.example.com/server-b/")
                .webhookUrlMethod(CallDialParams.WebhookUrlMethod.POST)
                .build()

        val body = params._body()

        assertThat(body.connectionId()).isEqualTo("7267xxxxxxxxxxxxxx")
        assertThat(body.from()).isEqualTo("+18005550101")
        assertThat(body.to())
            .isEqualTo(CallDialParams.To.ofString("+18005550100 or sip:username@sip.telnyx.com"))
        assertThat(body.answeringMachineDetection())
            .contains(CallDialParams.AnsweringMachineDetection.DETECT)
        assertThat(body.answeringMachineDetectionConfig())
            .contains(
                CallDialParams.AnsweringMachineDetectionConfig.builder()
                    .afterGreetingSilenceMillis(1000)
                    .betweenWordsSilenceMillis(1000)
                    .greetingDurationMillis(1000)
                    .greetingSilenceDurationMillis(2000)
                    .greetingTotalAnalysisTimeMillis(50000)
                    .initialSilenceMillis(1000)
                    .maximumNumberOfWords(1000)
                    .maximumWordLengthMillis(2000)
                    .silenceThreshold(512)
                    .totalAnalysisTimeMillis(5000)
                    .build()
            )
        assertThat(body.audioUrl()).contains("http://www.example.com/sounds/greeting.wav")
        assertThat(body.billingGroupId()).contains("f5586561-8ff0-4291-a0ac-84fe544797bd")
        assertThat(body.bridgeIntent()).contains(true)
        assertThat(body.bridgeOnAnswer()).contains(true)
        assertThat(body.clientState()).contains("aGF2ZSBhIG5pY2UgZGF5ID1d")
        assertThat(body.commandId()).contains("891510ac-f3e4-11e8-af5b-de00688a4901")
        assertThat(body.conferenceConfig())
            .contains(
                CallDialParams.ConferenceConfig.builder()
                    .id("0ccc7b54-4df3-4bca-a65a-3da1ecc777f0")
                    .beepEnabled(CallDialParams.ConferenceConfig.BeepEnabled.ON_EXIT)
                    .conferenceName("telnyx-conference")
                    .earlyMedia(false)
                    .endConferenceOnExit(true)
                    .hold(true)
                    .holdAudioUrl("http://example.com/message.wav")
                    .holdMediaName("my_media_uploaded_to_media_storage_api")
                    .mute(true)
                    .softEndConferenceOnExit(true)
                    .startConferenceOnCreate(false)
                    .startConferenceOnEnter(true)
                    .supervisorRole(CallDialParams.ConferenceConfig.SupervisorRole.WHISPER)
                    .addWhisperCallControlId(
                        "v2:Sg1xxxQ_U3ixxxyXT_VDNI3xxxazZdg6Vxxxs4-GNYxxxVaJPOhFMRQ"
                    )
                    .addWhisperCallControlId(
                        "v2:qqpb0mmvd-ovhhBr0BUQQn0fld5jIboaaX3-De0DkqXHzbf8d75xkw"
                    )
                    .build()
            )
        assertThat(body.customHeaders().getOrNull())
            .containsExactly(
                CustomSipHeader.builder().name("head_1").value("val_1").build(),
                CustomSipHeader.builder().name("head_2").value("val_2").build(),
            )
        assertThat(body.dialogflowConfig())
            .contains(
                DialogflowConfig.builder()
                    .analyzeSentiment(false)
                    .partialAutomatedAgentReply(false)
                    .build()
            )
        assertThat(body.enableDialogflow()).contains(false)
        assertThat(body.fromDisplayName()).contains("Company Name")
        assertThat(body.linkTo())
            .contains("ilditnZK_eVysupV21KzmzN_sM29ygfauQojpm4BgFtfX5hXAcjotg==")
        assertThat(body.mediaEncryption()).contains(CallDialParams.MediaEncryption.SRTP)
        assertThat(body.mediaName()).contains("my_media_uploaded_to_media_storage_api")
        assertThat(body.parkAfterUnbridge()).contains("self")
        assertThat(body.preferredCodecs()).contains("G722,PCMU,PCMA,G729,OPUS,VP8,H264")
        assertThat(body.record()).contains(CallDialParams.Record.RECORD_FROM_ANSWER)
        assertThat(body.recordChannels()).contains(CallDialParams.RecordChannels.SINGLE)
        assertThat(body.recordCustomFileName()).contains("my_recording_file_name")
        assertThat(body.recordFormat()).contains(CallDialParams.RecordFormat.WAV)
        assertThat(body.recordMaxLength()).contains(1000)
        assertThat(body.recordTimeoutSecs()).contains(100)
        assertThat(body.recordTrack()).contains(CallDialParams.RecordTrack.OUTBOUND)
        assertThat(body.recordTrim()).contains(CallDialParams.RecordTrim.TRIM_SILENCE)
        assertThat(body.sendSilenceWhenIdle()).contains(true)
        assertThat(body.sipAuthPassword()).contains("password")
        assertThat(body.sipAuthUsername()).contains("username")
        assertThat(body.sipHeaders().getOrNull())
            .containsExactly(
                SipHeader.builder().name(SipHeader.Name.USER_TO_USER).value("12345").build()
            )
        assertThat(body.sipRegion()).contains(CallDialParams.SipRegion.CANADA)
        assertThat(body.sipTransportProtocol()).contains(CallDialParams.SipTransportProtocol.TLS)
        assertThat(body.soundModifications())
            .contains(
                SoundModifications.builder()
                    .octaves(0.1)
                    .pitch(0.8)
                    .semitone(-2.0)
                    .track("both")
                    .build()
            )
        assertThat(body.streamBidirectionalCodec()).contains(StreamBidirectionalCodec.G722)
        assertThat(body.streamBidirectionalMode()).contains(StreamBidirectionalMode.RTP)
        assertThat(body.streamBidirectionalSamplingRate())
            .contains(StreamBidirectionalSamplingRate.RATE_16000)
        assertThat(body.streamBidirectionalTargetLegs())
            .contains(StreamBidirectionalTargetLegs.BOTH)
        assertThat(body.streamCodec()).contains(StreamCodec.PCMA)
        assertThat(body.streamEstablishBeforeCallOriginate()).contains(true)
        assertThat(body.streamTrack()).contains(CallDialParams.StreamTrack.BOTH_TRACKS)
        assertThat(body.streamUrl()).contains("wss://www.example.com/websocket")
        assertThat(body.superviseCallControlId())
            .contains("v3:MdI91X4lWFEs7IgbBEOT9M4AigoY08M0WWZFISt1Yw2axZ_IiE4pqg")
        assertThat(body.supervisorRole()).contains(CallDialParams.SupervisorRole.BARGE)
        assertThat(body.timeLimitSecs()).contains(60)
        assertThat(body.timeoutSecs()).contains(60)
        assertThat(body.transcription()).contains(true)
        assertThat(body.transcriptionConfig())
            .contains(
                TranscriptionStartRequest.builder()
                    .clientState("aGF2ZSBhIG5pY2UgZGF5ID1d")
                    .commandId("891510ac-f3e4-11e8-af5b-de00688a4901")
                    .transcriptionEngine(TranscriptionStartRequest.TranscriptionEngine.GOOGLE)
                    .transcriptionEngineConfig(
                        TranscriptionEngineGoogleConfig.builder()
                            .enableSpeakerDiarization(true)
                            .addHint("string")
                            .interimResults(true)
                            .language(GoogleTranscriptionLanguage.EN)
                            .maxSpeakerCount(4)
                            .minSpeakerCount(4)
                            .model(TranscriptionEngineGoogleConfig.Model.LATEST_LONG)
                            .profanityFilter(true)
                            .addSpeechContext(
                                TranscriptionEngineGoogleConfig.SpeechContext.builder()
                                    .boost(1.0)
                                    .addPhrase("string")
                                    .build()
                            )
                            .transcriptionEngine(
                                TranscriptionEngineGoogleConfig.TranscriptionEngine.GOOGLE
                            )
                            .useEnhanced(true)
                            .build()
                    )
                    .transcriptionTracks("both")
                    .build()
            )
        assertThat(body.webhookUrl()).contains("https://www.example.com/server-b/")
        assertThat(body.webhookUrlMethod()).contains(CallDialParams.WebhookUrlMethod.POST)
    }

    @Test
    fun bodyWithoutOptionalFields() {
        val params =
            CallDialParams.builder()
                .connectionId("7267xxxxxxxxxxxxxx")
                .from("+18005550101")
                .to("+18005550100 or sip:username@sip.telnyx.com")
                .build()

        val body = params._body()

        assertThat(body.connectionId()).isEqualTo("7267xxxxxxxxxxxxxx")
        assertThat(body.from()).isEqualTo("+18005550101")
        assertThat(body.to())
            .isEqualTo(CallDialParams.To.ofString("+18005550100 or sip:username@sip.telnyx.com"))
    }
}
